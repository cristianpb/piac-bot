{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import { loadData } from './tools/searchTools';\n\timport { beforeUpdate, afterUpdate, onMount } from 'svelte';\n  import lunr from 'lunr';\n  import lunrstemmer from 'lunr-languages/lunr.stemmer.support';\n  import lunrfr from 'lunr-languages/lunr.fr';\n\n  lunrstemmer(lunr)\n  lunrfr(lunr)\n\n\tlet div;\n  let data;\n\tlet autoscroll;\n  let lunrIdx;\n  let etat = {};\n\n  const normaliseSpelling = function (builder) {\n    // Define a pipeline function that remove accents\n    var pipelineFunction = function (token) {\n      return token\n        .replace('á', 'a')\n        .replace('é', 'e')\n        .replace('í', 'i')\n        .replace('ó', 'o')\n        .replace('ú', 'u')\n        .replace('Á', 'A')\n        .replace('É', 'E')\n        .replace('Í', 'I')\n        .replace('Ó', 'O')\n        .replace('Ú', 'U');\n    }\n\n    // Register the pipeline function so the index can be serialised\n    lunr.Pipeline.registerFunction(pipelineFunction, 'normaliseSpelling')\n\n    // Add the pipeline function to both the indexing pipeline and the\n    // searching pipeline\n    builder.pipeline.before(lunr.stemmer, pipelineFunction)\n    builder.searchPipeline.before(lunr.stemmer, pipelineFunction)\n  }\n\n  onMount(async () => {\n    data = await loadData()\n    lunrIdx = lunr(function () {\n      console.log(`loaded ${data.length}`);\n      this.use(normaliseSpelling)\n      this.use(lunr.fr)\n      this.ref('id')\n      this.field('question', {boost: 10})\n      this.field('response')\n      //this.field('responseGN')\n\n      data.forEach((doc, idx) => {\n        doc.id = idx\n        this.add(doc)\n      }, this)\n    })\n  })\n\n\tbeforeUpdate(() => {\n\t\tautoscroll = div && (div.offsetHeight + div.scrollTop) > (div.scrollHeight - 20);\n\t});\n\n\tafterUpdate(() => {\n\t\tif (autoscroll) div.scrollTo(0, div.scrollHeight)\n\t});\n\n\tlet comments = [\n\t\t{ auth: 'chatbot', text: 'Bonjour,' },\n\t\t{ auth: 'chatbot', text: 'Je suis PIAC Bot' },\n\t\t{ auth: 'chatbot', text: 'Quelle est votre question ?' }\n\t];\n\n  function handleSubmit(event) {\n    if (event.which === 13) {\n      event.preventDefault();\n      const text = event.target.value;\n      if (!text) return;\n\n      comments = comments.concat({\n        author: 'user',\n        text\n      });\n\n      event.target.value = '';\n\n      const cleanText = text.replace('l\\'','')\n\n      const goodbyeRegex = /(merci|bye|chao|au revoir)/\n      if (cleanText.match(goodbyeRegex) && (cleanText.match(goodbyeRegex).length > 0)) {\n        handleAnswer(`Merci, au revoir`)\n      } else if (etat.results && etat.results.length > 0) {\n        const regex = /[0-9]+/g;\n        const found = cleanText.match(regex);\n        console.log(found[0]);\n        console.log(parseInt(found[0]));\n        const indexResult = parseInt(found[0] - 1)\n        console.log(indexResult);\n        console.log(etat.results)\n        console.log(data[indexResult])\n        handleAnswer(`${data[indexResult].response}`)\n        handleAnswer(`Voici plus de précision sur le sujet`)\n        delete etat.results\n      } else {\n        etat.results = handleSearch(cleanText)\n        if (etat.results.length > 0 ) {\n          handleAnswer(`J'ai trouvé les résultats suivants`)\n          etat.results.forEach(result => {\n            setTimeout(() => { \n              handleAnswer(result.question); \n              setTimeout(() => { \n              }, 1000)\n            }, 1000)\n          })\n          handleAnswer('Quel question vous voulez en savoir plus?'); \n        } else {\n          handleAnswer(`Je n'ai pas trouvé de résultats`)\n        }\n      }\n    }\n  }\n\n  const handleSearch = (searchTerm) => {\n    if (searchTerm) {\n      const results = lunrIdx.search(searchTerm)\n      const filteredResults = results\n        .filter(item => item.score > 0.9)\n        .map(item => {\n          console.log(item);\n          return data[item.ref]\n        })\n      return filteredResults\n    } else {\n      return []\n    }\n  }\n\n  const handleAnswer = (reply) => {\n    setTimeout(() => {\n      comments = comments.concat({\n        author: 'otheruser',\n        text: '...',\n        placeholder: true\n      });\n\n      setTimeout(() => {\n        comments = comments.filter(comment => !comment.placeholder).concat({\n          author: 'otheruser',\n          text: reply\n        });\n      }, 500 + Math.random() * 500);\n    }, 200 + Math.random() * 200);\n  }\n\n</script>\n\n<style>\n\t.chat {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\theight: 100%;\n\t}\n\n\t.title {\n\t\ttext-align: center;\n\t\tpadding: 10px 0;\n\t\tcolor: var(--title-color);\n\t\tborder-bottom: 1px solid var(--title-border-color);\n\t\tfont-family: var(--font-highlight);\n\t\tfont-size: 1.4em;\n\t}\n\n\t.scrollable {\n\t\tflex: 1 1 auto;\n\t\toverflow-y: auto;\n\t\tpadding: 1em;\n\t\tbackground-color: var(--bg-scrollable);\n\t}\n\n\tarticle {\n\t\tmargin: 0.5em 0;\n\t}\n\n\t.user {\n\t\ttext-align: right;\n\t}\n\n\tspan {\n\t\tpadding: 0.5em 1em;\n\t\tdisplay: inline-block;\n\t}\n\n\t.otheruser span {\n\t\tbackground-color: var(--color-conversation-otheruser);\n\t\tcolor: var(--color-conversation-otheruser-contrast);\n\t\tborder-radius: 1em 1em 1em 0;\n\t}\n\n\t.user span {\n\t\tbackground-color: var(--color-conversation-user);\n\t\tcolor: var(--color-conversation-user-contrast);\n\t\tborder-radius: 1em 1em 0 1em;\n\t}\n\n\t.form {\n\t\tpadding: 0.6em 1em 0.2em 1em;\n\t\tdisplay: flex;\n\t\tbox-shadow: 0 -2px 1px rgba(0, 0, 0, 0.1);\n\t\tposition: relative;\n\t}\n\n\t.form input {\n\t\tflex: 1 1 auto;\n\t}\n</style>\n\n<div class=\"chat\">\n\t<h1 class=\"title\">PIAC Bot</h1>\n\n\t<div class=\"scrollable\" bind:this={div}>\n\t\t{#each comments as comment}\n\t\t\t<article class={comment.author}>\n\t\t\t\t<span>{comment.text}</span>\n\t\t\t</article>\n\t\t{/each}\n\t</div>\n\n\t<div class=\"form\">\n\t\t<input on:keydown={handleSubmit}>\n\t</div>\n</div>\n"
  ],
  "names": [],
  "mappings": "AA6JC,KAAK,8BAAC,CAAC,AACN,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,MAAM,CAAE,IAAI,AACb,CAAC,AAED,MAAM,8BAAC,CAAC,AACP,UAAU,CAAE,MAAM,CAClB,OAAO,CAAE,IAAI,CAAC,CAAC,CACf,KAAK,CAAE,IAAI,aAAa,CAAC,CACzB,aAAa,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,oBAAoB,CAAC,CAClD,WAAW,CAAE,IAAI,gBAAgB,CAAC,CAClC,SAAS,CAAE,KAAK,AACjB,CAAC,AAED,WAAW,8BAAC,CAAC,AACZ,IAAI,CAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CACd,UAAU,CAAE,IAAI,CAChB,OAAO,CAAE,GAAG,CACZ,gBAAgB,CAAE,IAAI,eAAe,CAAC,AACvC,CAAC,AAED,OAAO,8BAAC,CAAC,AACR,MAAM,CAAE,KAAK,CAAC,CAAC,AAChB,CAAC,AAED,KAAK,8BAAC,CAAC,AACN,UAAU,CAAE,KAAK,AAClB,CAAC,AAED,IAAI,8BAAC,CAAC,AACL,OAAO,CAAE,KAAK,CAAC,GAAG,CAClB,OAAO,CAAE,YAAY,AACtB,CAAC,AAED,yBAAU,CAAC,IAAI,eAAC,CAAC,AAChB,gBAAgB,CAAE,IAAI,8BAA8B,CAAC,CACrD,KAAK,CAAE,IAAI,uCAAuC,CAAC,CACnD,aAAa,CAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,AAC7B,CAAC,AAED,oBAAK,CAAC,IAAI,eAAC,CAAC,AACX,gBAAgB,CAAE,IAAI,yBAAyB,CAAC,CAChD,KAAK,CAAE,IAAI,kCAAkC,CAAC,CAC9C,aAAa,CAAE,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,AAC7B,CAAC,AAED,KAAK,8BAAC,CAAC,AACN,OAAO,CAAE,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAC5B,OAAO,CAAE,IAAI,CACb,UAAU,CAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CACzC,QAAQ,CAAE,QAAQ,AACnB,CAAC,AAED,oBAAK,CAAC,KAAK,eAAC,CAAC,AACZ,IAAI,CAAE,CAAC,CAAC,CAAC,CAAC,IAAI,AACf,CAAC"
}